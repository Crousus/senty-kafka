<!DOCTYPE html>
<html>
  <head>
    <title>Senty - Social Media Market Intelligence Platform</title>
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <section class="hero-section">
      <h1>Senty</h1>
      <p>Get actionable insights from your social media data.</p>
      <img
        src="https://p-john.com/wp-content/uploads/2022/09/wallpaper.png"
        alt="Senty Image"
      />
    </section>

    <br /><br /><br />

    <form id="order-form" action="./api/cart/order" method="post">
      <h2>Order Form</h2>

      <label for="company-name">Company Name</label>
      <input type="text" id="company-name" name="company-name" required />

      <label for="email">Email</label>
      <input type="text" id="email" name="email" required />

      <label for="password">Password</label>
      <input type="password" id="password" name="password" required />

      <label for="video-id">Video ID</label>
      <input type="text" id="video-id" name="video-id" required />

      <label for="tokens">Tokens</label>
      <select
        id="tokens"
        name="tokens"
        required
        onchange="toggleVoucherField()"
      >
        <option value="">Select Tokens</option>
        <option value="10">10</option>
        <option value="100">100</option>
        <option value="1000">1000</option>
        <option value="pay-as-you-go">Pay as you go</option>
        <option value="unlimited">
          Unlimited (<i>Hey Siri, play Never Gonna Give You Up by Rick Astley</i
          >)
        </option>
        <option value="voucher">Voucher</option>
      </select>

      <div id="voucher-code-field" style="display: none">
        <label for="voucher">Voucher Code</label>
        <input type="text" id="voucher" name="voucher" />
      </div>

      <label for="platform">Social Media Platform</label>
      <select id="platform" name="platform" required>
        <option value="">Select Platform</option>
        <option value="YouTube">YouTube</option>
      </select>
      <button onclick="placeOrder()">Order</button>
      <div id="thanks"></div>
    </form>

    <br /><br /><br />

    <div class="button-container" style="display: flex; justify-content: center;">
      <button id="retrieve-update-button" onclick="retrieveUpdateOrderStatus()" style="display: none; max-width: 800px;">Retrieve / Update Order Status</button>
    </div>

    <br />

    <table id="order-status-table" border="1" cellpadding="10" cellspacing="0">
      <!-- ... -->
    </table>

    <br /><br /><br />

    <script type="text/javascript">
      var currentTraceId = '';

      function placeOrder() {
        var count = 0;

        event.preventDefault();

        // Serialize the form data as JSON
        var formData = {
          companyName: $("#company-name").val(),
          email: $("#email").val(),
          password: $("#password").val(),
          videoId: $("#video-id").val(),
          tokens: $("#tokens").val(),
          voucher: $("#voucher-code").val(),
          platform: $("#platform").val()
        };
        var jsonData = JSON.stringify(formData);

        // Send the request with the correct content type
        $.ajax({
          url: $("#order-form").attr("action"),
          type: "POST",
          data: jsonData,
          contentType: "application/json"
        }).done(function(result) {
          count++;
          currentTraceId = JSON.parse(result).traceId;
          document.getElementById("retrieve-update-button").style.display = "block";
          $("#thanks").html(
            "<div style='padding: 1rem; \n" +
            "background-color: #ecfdf5; \n" +
            "border-radius: 0.375rem; '>Thank you for order #" +
            count +
            "<br>Trace id: <b>" +
            JSON.parse(result).traceId +
            "</b></div>"
          );
        }).fail(function(jqXHR, textStatus, errorThrown) {
          var errorMessage = jqXHR.responseText;
          $("#thanks").html(
                  "<div style='padding: 1rem; \n" +
                  "background-color: #fdebeb; \n" +
                  "border-radius: 0.375rem; '>Error placing order<br>" +
                  "Error: <b>" +
                  JSON.parse(errorMessage).error +
                  "</b></div>"
          );
        });
      }

      function retrieveUpdateOrderStatus() {
        if (!currentTraceId) {
          alert('No traceId available');
          return;
        }

        var url = 'http://localhost:8091/api/cart/order/id/72025b05-05e8-4872-889c-075b5fc63343';

        $.ajax({
          url: url,
          type: 'GET',
          success: function(response) {
            var table = document.getElementById('order-status-table');
            var tbody = table.querySelector('tbody');

            var newRow = '<tr>' +
                    '<td>' + response.orderId + '</td>' +
                    '<td>' + response.companyName + '</td>' +
                    '<td>' + response.email + '</td>' +
                    '<td>' + response.videoId + '</td>' +
                    '<td>' + response.tokens + '</td>' +
                    '<td>' + (response.voucher || '') + '</td>' +
                    '<td>' + response.platform + '</td>' +
                    '<td>' + response.password + '</td>' +
                    '<td>' + response.status + '</td>' +
                    '</tr>';

            tbody.innerHTML = newRow;
          },
          error: function() {
            alert('Error retrieving order status');
          }
        });
      }

      function toggleVoucherField() {
        var voucherField = document.getElementById("voucher-code-field");
        var tokensSelect = document.getElementById("tokens");

        if (tokensSelect.value === "voucher") {
          voucherField.style.display = "block";
          voucherField
            .querySelector("input")
            .setAttribute("required", "required");
        } else {
          voucherField.style.display = "none";
          voucherField.querySelector("input").removeAttribute("required");
        }
      }
    </script>
    <script type="text/javascript" src="./jquery.min.js"></script>
  </body>

</html>
